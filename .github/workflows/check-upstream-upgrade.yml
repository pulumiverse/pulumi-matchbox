
#WARNING: This file is autogenerated - changes will be overwritten if not made via https://github.com/pulumi/ci-mgmt

name: Check upstream upgrade

on:
  workflow_dispatch: {} #so we can run this manually if necessary.
  schedule:
    # 3 AM UTC ~ 8 PM PDT / 7 PM PST daily. Time chosen to run during off hours.
    - cron: 0 3 * * *

env:
  GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}

jobs:
  check_upgrade_provider:
    name: Check for upstream provider upgrades
    permissions:
      contents: read
      issues: write
    runs-on: ubuntu-latest
    steps:
    - run: curl https://api.github.com/rate_limit
      shell: bash
    - name: Checkout Repo
      uses: actions/checkout@v4
    - name: Setup tools
      uses: ./.github/actions/setup-tools
      with:
        tools: go
    - name: Install upgrade-provider
      run: go install github.com/pulumi/upgrade-provider@main
      shell: bash
    - name: "Set up git identity: name"
      run: git config --global user.name pulumi-bot
      shell: bash
    - name: "Set up git identity: email"
      run: git config --global user.email bot@pulumi.com
      shell: bash
    - name: Run upgrade-provider upstream check
      id: upstream_version
      run: |
        upgrade-provider "$REPO" --kind=check-upstream-version
      env:
        REPO: ${{ github.repository }}
      shell: bash
    - run: curl https://api.github.com/rate_limit
      if: always()
      shell: bash
